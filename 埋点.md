1⃣️一、什么是埋点
在前端业务开发中，"埋点"通常指的是在应用程序中特定的位置或事件触发时记录用户行为或应用程序状态的过程。这种记录通常用于分析用户行为、监控应用程序性能、评估功能使用情况以及优化用户体验。埋点可以捕获用户的点击、页面浏览、交互动作等行为，并将这些数据发送到后端服务或第三方分析工具进行进一步处理和分析。
参考链接：https://www.bilibili.com/read/cv17517214/
    https://www.bilibili.com/read/cv22600289/
2⃣️二、埋点形式
1. 代码埋点🔆（实践中所采用的埋点形式）
为监测网站上/APP上用户的行为，是需要在网页/APP中加上一些代码的，当用户触发相应行为时，进行数据上报，也就是代码埋点。
优点：可以详细的设置某一个事件自定义属性
缺点：时间、人力成本大，数据传输的时效性 

2. 可视化埋点
利用可视化交互手段，数据产品/数据分析师可以通过可视化界面（管理后台连接设备） 配置事件，可视化埋点仍需要先配置相关事件，再采集。
优点：埋点只需业务人员接入，无需开发人员支持
缺点：仅支持客户端（APP）行为

3. 无埋点
无埋点也被叫做全埋点，是指开发人员集成采集 SDK 后，SDK 便直接开始捕捉和监测用户在应用里的所有行为，并全部上报，不需要开发人员添加额外代码。数据分析师/数据产品 通过管理后台的圈选功能来选出自己关注的用户行为，并给出事件命名。之后就可以结合时间属性、用户属性、事件进行分析了。所以无埋点并不是真的不用埋点了。
优点：无需开发，业务人员埋点即可；支持先上报数据，后进行埋点。
缺点：数据存储量大 

无埋点和可视化埋点均不需要开发支持，仅数据业务人员进行设置即可。但两者数据上报埋点设置存在加大的差异：无埋点是无差别采集所有用户数据，可视化埋点是根据配置的要采集数据信息进行数据收集，因而无埋点上报的数据量远大于可视化埋点。

3⃣️三、代码埋点方案
在进行可视化埋点和无埋点是可以借助三方平台方案进行实现，如神策、友盟、腾讯移动分析、Talkingdata，GrowingIO等。如果对数据安全比较重视，业务又相对复杂，公司则通常是使用代码埋点方式采集数据，并搭建相应的数据产品实现其数据应用或是分析的诉求 。
在埋点的技术方案中，首先要重视的，是用户唯一标识的建设。如果做不到对用户的唯一识别，那么基础的UV统计，都将是错误的。因此，在数据埋点方案中，有两个信息是一定要记录的，即设备ID+用户ID。设备ID代表用户使用哪个设备，如安卓的ANDROID_ID/IMEI，IOS中的IDFA/UDID，浏览器的Cookie，小程序的OpenID等。用户ID，代表用户在产品中所注册的账号，通常是手机号，也可以是邮箱等其他格式。当这两个信息能够获得时，不论是用户更换设备，或者是同一台设备不同账号登录，我们都能够根据这两个ID，来识别出谁在对设备做操作。
在Web开发过程中，Web端数据采集主要通过三种方式实现：服务器日志、URL解析及JS回传。 

4⃣️四、埋点流程规范
规划评审
技术开发❗❗❗
  a. 埋点的开发，简单讲，是分成行为埋点（用户浏览什么内容、浏览时间）和事件埋点（视频点击次数、视频下载次数）两个大类，每一类根据端的不同进行相应的开发。
参考链接：
https://neo-pages.bilibili.com/bili-utils/bili-mirror/methdos/customReportPb.html
bili-mirror⬇️：
基本介绍
bili-mirror 是一个前端监控的解决方案,我们基于report-pb作为上报，提供了一整套的数据监控，错误监控，上报，日志，告警，观远看板的功能。
bili-mirror 是整体前端监控解决方式的结构是一站式的体验，使用它可以做到：
● 自动捕获JS错误、Promise错误、资源加载错误日志上报
● 白屏检测上报
● 自动监控性能上报、自定义性能上报
● 业务上报和技术上报的封装直接使用
● 定制专属上报
● 支持生命周期的插件注入
● 用户行为日志记录
● 支持离线用户日志全记录-上传并且分析
● 上报接通告警配置
● 数据可视化表报
● 对应丰富的apm后台平台化指标

业务上报 ⬇️
业务上报：customReportPb
通过 customReportPb or customReport 都可以来实现业务上报，通常是产品需求埋点上报
业务上报，可以在北极星查看数据，落表 b_dwd.dwd_flow_ubt_web_event_l_hr
customReportPb(options:reportPbOptions,newOptions?: pbConfig):void
      type reportPbOptions = {
      type:  'pv' | 'pv_unload' | 'click' | 'exposure' | 'player' | 'custom'    // exposure 对应appear，曝光上报
      eventId: string   // event—Id 例如 vipbuy.big-account.click
      msg?: Object // 私有参数
      otherSpmId?: string // 需要特定覆盖spm_id的情况传入
}
pbConfig // 同pb配置选项，一般不需要
TIP
业务上报和技术上报的eventId，不需要前置传 spm_id,会默认拼， 比如 eventId:home-page.navBar.click, 最终上报会变成 333.1007.home-page.navbar.click
import {customReportPb} from '@bilibili/bili-mirror'
customReportPb({
  type:'click',
  eventId:'account-pc.loginBtn.click',
  msg:{
    // 一些私参
  }
})
WARNING
如果eventId只有1段式(比如:account),以'.'分割为段，那么mirror为了保持数据一致性，会默认填充,最终上报会变成:"页面spmid.你的orgin.你的module.account"
如何检查一个上报和解析一个上报:

、
● pb-report埋点检查工具


埋点验证❗❗❗
埋点的验证很关键，如果上线后才发现问题，那么历史数据是无法追溯的。
验证有两种方式，一种是实时的功能验证，一种是离线的日志验证。
实时功能验证，指功能开发好后，在灰度环境上测试相应的埋点功能是否正常，比如点击相应的业务模块，日志是否会正确的打印出来。通常而言，我们需要验证如下三个类型的问题：
１、记录正确：APP发生相应的动作，检查日志是否打印正确，如：打开页面（行为埋点）、点击按钮（事件埋点）时，是否日志会记录；
２、位置正确：查看SPM、SCM码与平台申请的是否一致；
３、内容正确：设备ID、用户ID等必须记录的内容是否正确，行为、事件记录内容是否与页面实际发生的一致。
离线的日志验证，我们需要把日志写到测试环境中，查看数据上报的过程是否正确，以及对上报后的数据进行统计，侧面验证记录的准确性，如统计基本的PV、UV，行为、事件的发生数量。
哔哩哔哩使用的是北极星


发布上线
监测评估

5⃣️五、代码实例
埋点是：

这里埋点需求是：跳转到端内后，获取到登录态，重定向到空间页之前上报

customReportPb({
      type:'exposure',
      eventId:'0.0.show',
      otherSpmId:'333.1389',
      msg: {
          mid: userInfo.mid,
          vip_status: role_map_status[userInfo.vip?.role],
          status: userInfo.vip?.status,
        }
   })
之所以有一个 role_map_status是因为

枚举值是这些
1：百年大会员 2：十年大会员 3：年度大会员 4：普通大会员 5：非会员
与查找表中的数据是不想通的
这时候就需要写一个role_map_status映射正确的值
无任何角色0 ---- 即非会员5
仅大会员1 ---- 即普通大会员4
大会员➕年度3 ---- 即年度大会员3
大会员➕年度➕十年7 ---- 即十年大会员2
大会员➕年度➕十年➕百年 ---- 即百年大会员1

